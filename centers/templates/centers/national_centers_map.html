{% extends "centers/base_staff.html" %}
{% block content %}

<h4 class="mb-3">National Centers Map</h4>

<div id="map" style="height: 75vh; border-radius: 10px;"></div>

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  const centers = [
    {% for c in centers %}
      {
        name: "{{ c.name|escapejs }}",
        code: "{{ c.center_code|escapejs }}",
        territory: "{{ c.territory|escapejs }}",
        cluster: "{{ c.cluster|escapejs }}",
        lat: {{ c.latitude }},
        lng: {{ c.longitude }},
      },
    {% endfor %}
  ];

  const map = L.map("map");

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: "Â© OpenStreetMap contributors"
  }).addTo(map);

  const bounds = [];

  centers.forEach(c => {
    const marker = L.marker([c.lat, c.lng]).addTo(map);
    bounds.push([c.lat, c.lng]);

    const gmaps = `https://www.google.com/maps?q=${c.lat},${c.lng}`;

    marker.bindPopup(`
      <b>${c.name}</b><br/>
      Code: ${c.code}<br/>
      ${c.territory} | ${c.cluster}<br/>
      <a href="${gmaps}" target="_blank">Open in Google Maps</a>
    `);
  });

  if (bounds.length > 0) {
    map.fitBounds(bounds, { padding: [20, 20] });
  } else {
    map.setView([5.6, -0.18], 7);
  }
</script>

{% endblock %}